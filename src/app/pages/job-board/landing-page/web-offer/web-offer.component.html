<hr>

<div class="p-grid">
    <div class="p-col-12 p-sm-12 p-md-6 p-lg-5 p-xl-4">
        <div class="card p-shadow-2">
            <h4>Filtrado por categorias.</h4>
            <p-splitButton label="Filtrar" icon="pi pi-filter"
                           (onClick)="filterForCategories()" styleClass="p-mb-2 p-mr-2"
                           [model]="items"></p-splitButton>
            <p-button icon="pi pi-filter-slash" label="Limpiar" styleClass="p-mb-2 p-button-secondary"
                      (click)="cleanFilters()"></p-button>
            <p-tree [value]="treeData" [virtualScroll]="false" [scrollHeight]="scrollHeight"
                    [virtualNodeHeight]="100" selectionMode="checkbox" [(selection)]="selectedCategories"
                    [filter]="true" emptyMessage="Sin datos."></p-tree>
        </div>
    </div>
    <div class="p-col-12 p-sm-12 p-md-6 p-lg-7 p-xl-8">
        <div class="card p-mt-0 p-shadow-2">
            <div class="p-grid p-ai-center vertical-container">
                <label *ngIf="displayXButton" class="p-col-12 p-sm-12 p-md-12 p-xl-12">
                    Puedes filtrar por información adicional, ciudad, posición y categoría.</label>
                <div class="p-col-12 p-sm-12 p-md-12 p-xl-4">
                    <span class="p-input-icon-right">
                        <input #search type="text" pInputText placeholder="Buscar"
                               [(ngModel)]="generalSearch"
                               (keyup)="clearInputSearch(true)" (keyup.enter)="generalFilter(search.value)"/>
                        <i class="pi pi-times" *ngIf="displayXButton" (click)="clearInputSearch(false)"></i>
                    </span>
                </div>
                <div class="p-col-12 p-sm-12 p-md-12 p-xl-8">
                    <p-paginator [rows]="paginator.per_page"
                                 [totalRecords]="paginator.total"
                                 (onPageChange)="pageChange($event)"></p-paginator>
                </div>
            </div>
            <app-offer-data-view [offers]="offers"
                                 (argsFilters)="generalFilter($event)"></app-offer-data-view>
        </div>
    </div>
</div>

<p-dialog header="Filtros" [(visible)]="displayModalFilter" [modal]="true"
          [maximizable]="false" [draggable]="false" [resizable]="false">

    <div *ngIf="displayMoreFilters" class="p-fluid">
        <form [formGroup]="formMoreFilters" (submit)="filterForMore()">
            <p-toast position="top-center" key="errorSpecificField"></p-toast>
            <div class="p-formgrid">
                <div class="p-field p-col">
                    <h3>Cargo:</h3>
                    <input id="position" type="text" formControlName="position" pInputText/>
                </div>
            </div>
            <div class="p-formgrid p-grid">
                <div class="p-field p-col">
                    <h3>Campo Amplio:</h3>
                    <p-autoComplete formControlName="wideField" [suggestions]="filteredWideCategory"
                                    [dropdown]="true" field="label"
                                    (completeMethod)="filterWideField($event)"
                                    (onSelect)="updateSpecificField(wideField)"
                                    (onKeyUp)="updateSpecificField(wideField)"
                                    placeholder="Campo amplio">
                        <ng-template let-parentCategory pTemplate="item">
                            <div class="country-item">
                                <div>{{parentCategory.label}}</div>
                            </div>
                        </ng-template>
                    </p-autoComplete>
                </div>

                <div class="p-field p-col">
                    <h3>Campo Específico:</h3>
                    <p-autoComplete formControlName="specificField" [suggestions]="filteredSpecificCategory"
                                    [dropdown]="true" field="label"
                                    (completeMethod)="filterSpecificField($event)"
                                    placeholder="Campo específico">
                        <ng-template let-specificCategory pTemplate="item">
                            <div class="country-item">
                                <div>{{specificCategory.label}}</div>
                            </div>
                        </ng-template>
                    </p-autoComplete>
                </div>
            </div>
            <app-location [option]="3" (formLocationOut)="locationOut($event)"></app-location>

            <div class="p-dialog-footer">
                <p-button type="submit" icon="pi pi-filter" label="Filtrar"
                          class="p-button-text"></p-button>
                <p-button icon="pi pi-times" styleClass="p-button-secondary" (click)="displayModalFilter=false"
                          label="Cerrar"></p-button>
            </div>
        </form>
    </div>

    <div *ngIf="displayCodeFilter" class="p-fluid">
        <form [formGroup]="formCodeFilter" (submit)="filterForCode()">
            <div class="p-field">
                <h3>Código:</h3>
                <p-inputNumber mode="decimal" autocomplete="off"
                               [useGrouping]="false" formControlName="code">
                </p-inputNumber>
            </div>

            <div class="p-dialog-footer">
                <p-button type="submit" icon="pi pi-filter" label="Filtrar"
                          class="p-button-text"></p-button>
                <p-button icon="pi pi-times" styleClass="p-button-secondary" (click)="displayModalFilter=false"
                          label="Cerrar"></p-button>
            </div>
        </form>
    </div>

</p-dialog>
